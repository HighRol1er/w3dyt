### 개선할 곳

1. scrpits/auto-upbit-market-data.ts (NOTE:)
2. upbit-websocket.service.ts (XXX: 웹소켓 연결 시도 횟수 제한 필요) - 해결

### 현재 문제점

2월 14일

- websocket으로 받은 데이터를 한번은 저장해야되는데
  Redis에 저장할지 PostgreSQL에 저장할지 고민중
  이게 지금 어떻게 저장을 해야할지 모르겠음

### WebSocket 사용 이유

API를 사용하는 것보다 실시간 데이터에 어울림
polling 방식 이런거 뭐 있던데 좀 더 알아보자

### Redis 사용 이유(2/16)

- 소켓만 연결한 채로 냅두게 되면 거래가 일어나지 않는 데이터는 즉각적으로 UI에 들어오지 않음
  미리 Redis가 가지고 있는 데이터를 클라이언트에게 넘겨주고 소켓을 연결 시켜야 함
  -> 근데 굳이 Redis를 사용할 필요가 있는지 모르겠음
  Why? => upbit에서 실시간 스냅샷 기능을 제공하기 때문에
  만약 실시간 스냅샷 기능을 제공하지 않는 거래소가 있다면 이건 사용할 필요가 있긴 함

2월 17일

### 소켓 연결 테스트에서 발견한 문제 1

- 기본적인 틀이 되는 데이터를 db에서라도 딱 받아와서 schema대로 가격 데이터를 넣어줘야 할거같음
- 이래서 db를 써야하나? ..

### 소켓 연결 데스트에서 발견한 문제 2

- 웹소켓 특성상 connection이 되면 코인 가격 데이터들이 랜덤하게 (거래가 일어나는 순으로 ) 들어오게되는데

이 순서를 체계적으로 즉, 순서를 정해주기 위해서서는
db에 미리 거래소에 있는 코인 페어 정보를 넣어놓고 그거에 해당하는 데이터를 매칭해서 뿌려주는 로직이 필요할 듯

- DB 업데이트는 scripts를 디벨롭해서 폐지/상장 될때를 캐치해서 해야할 듯

### 데이터 포멧을 일정하게 가져가야할듯

- 너무 중구난방이다.
  /exchange, , /scripts 이렇게 둘다

### scripts

- 중복된 코드가 너무 많음
- 이거 코드 줄여보자

### base-ws.service.ts - 해결

- any 타입 제네릭을 쓰든 좀 바꾸자. <- 이건 지체하지말고 바로 수정하자
- any 타입 대신 유니온 타입으로 해결

### 웹소캣 연결하고 onclose 이벤트

- websocket 연결 끊기면 onclose 이벤트에 맞춰서
  다시 재연결하는 로직 필요.

### 2/19일 bybit 웹소캣 문제

- 한번에 구독할 수 있는 심볼이 10개
- 멀티 웹소캣(5개)으로 50개정도 까지 열어는 볼만한데
- 553개를 전부 열면 50개 이상을 열어야되서 문제임
- 이걸 어떻게 해결할 수 있을지는 좀 더 고민 일단 10개만 가져올 수 있게끔 코드 짜자

### 2/19일 coinbase 웹소캣 문제

- open price가 롤링 24시간이라서 우리나라 9시 기준이랑은 다르다.
- 정확한 open price를 계산하려면 스냅샷을 9시에 찍어서 이걸 기준으로 데이터를 다뤄줘야 함
- 현재는 빈값으로 냅뒀음

### 2/19일 okx 웹소캣 문제

- 애도 change rate coinbase 처럼 구해야줘야 함
- 현재는 빈값으로 냅뒀음
